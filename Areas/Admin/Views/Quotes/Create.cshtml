@model FeelShare.Web.Models.Quote
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Добавить цитату";
}

@section Styles {
    <style>
        :root {
            --ink: #0f172a; /* Основной тёмный текст (чернила) */
            --muted: #6b7280; /* Приглушённый серый текст */
            --card: #fff; /* Цвет карточек (фон белый) */
            --border: #e5e7eb; /* Цвет границ */
            --shadow: 0 10px 25px rgba(2,6,23,.06); /* Тень для карточек */
            --acc1: #8b5cf6; /* Фиолетовый (акцент) */
            --acc2: #06b6d4; /* Бирюзовый (акцент) */
            --acc3: #22c55e; /* Зелёный (акцент) */
            --acc4: #f59e0b; /* Жёлтый (акцент) */
        }

        .admin-hero {
            border-radius: 20px;
            padding: 22px 0;
            margin-bottom: 18px;
            background: linear-gradient(135deg,var(--acc1),var(--acc2));
            color: #fff;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

            .admin-hero .art {
                position: absolute;
                inset: -20% -10% auto auto;
                width: 60%;
                height: 160%;
                background: radial-gradient(closest-side,rgba(255,255,255,.25),transparent 65%);
                transform: rotate(18deg);
                filter: blur(8px);
            }

        .crumbs {
            --bs-breadcrumb-divider: "›";
            font-size: .95rem;
        }

            .crumbs .breadcrumb-item + .breadcrumb-item::before {
                color: rgba(255,255,255,.8);
            }

            .crumbs a {
                color: #fff;
                opacity: .9;
                text-decoration: none;
            }

                .crumbs a:hover {
                    opacity: 1;
                    text-decoration: underline;
                }

        .topbar {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 12px;
            align-items: center;
        }

        .btn-ghost {
            border: 1px dashed var(--border);
            color: var(--muted);
            background: #fff;
            padding: .45rem .85rem;
            border-radius: .65rem;
            text-decoration: none;
        }

            .btn-ghost:hover {
                border-color: var(--acc1);
                color: var(--acc1);
            }

        .card-ui {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: var(--shadow);
        }

            .card-ui .head {
                padding: 14px 16px;
                border-bottom: 1px solid var(--border);
                font-weight: 600;
                color: var(--ink);
            }

        .form-control, .form-select {
            border-color: var(--border);
        }

            .form-control:focus, .form-select:focus {
                border-color: #6366f1;
                box-shadow: 0 0 0 .25rem rgba(99,102,241,.12);
            }

        .quote-preview {
            background: #f9fafb;
            border-left: 3px solid var(--acc1);
            border-radius: 8px;
            padding: 14px 16px;
        }

            .quote-preview blockquote {
                margin: 0;
                font-size: 1.1rem;
                line-height: 1.6;
                color: var(--ink);
                quotes: "\201C" "\201D" "\2018" "\2019";
            }

                .quote-preview blockquote::before {
                    content: open-quote;
                    margin-right: .1rem;
                }

            .quote-preview footer {
                color: var(--muted);
            }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: .4rem;
            padding: .35rem .65rem;
            border-radius: 999px;
            background: #eef2ff;
            color: #4338ca;
            font-weight: 600;
            font-size: .85rem;
        }

        .actions-sticky {
            position: sticky;
            top: 18px;
            z-index: 10;
            display: flex;
            gap: .5rem;
            flex-wrap: wrap;
        }
    </style>
}


<section class="admin-hero">
    <div class="container px-3">
        <nav class="crumbs" aria-label="breadcrumb">
            <ol class="breadcrumb mb-2">
                <li class="breadcrumb-item"><a asp-area="Admin" asp-controller="Quotes" asp-action="Index">Цитаты</a></li>
                <li class="breadcrumb-item active text-white-50" aria-current="page">Добавить</li>
            </ol>
        </nav>
        <div class="topbar">
            <div>
                <h1 class="h3 fw-bold m-0">Добавить цитату</h1>
                <div class="text-white-50">Заполните поля, посмотрите предпросмотр и сохраните.</div>
            </div>
            <div class="actions-sticky">
                <button type="submit" form="quoteForm" name="saveAction" value="save-back" class="btn btn-primary">
                    Сохранить и назад
                </button>
                <button type="submit" form="quoteForm" name="saveAction" value="save-add" class="btn btn-outline-light">
                    Сохранить и добавить ещё
                </button>
                <a class="btn btn-ghost" asp-area="Admin" asp-controller="Quotes" asp-action="Index">Отмена</a>
            </div>
        </div>
    </div>
    <div class="art" aria-hidden="true"></div>
</section>



<div class="container px-3">
    <form asp-area="Admin" asp-controller="Quotes" asp-action="Create" method="post" id="quoteForm" novalidate>
        @Html.AntiForgeryToken()

        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

        <div class="row g-4">
            <!-- Левая колонка: текст и предпросмотр -->
            <div class="col-lg-8">
                <div class="card-ui mb-3">
                    <div class="head">Текст цитаты</div>
                    <div class="p-3 p-md-4">
                        <label class="form-label fw-semibold">Текст</label>
                        <textarea asp-for="Text" class="form-control" rows="6" maxlength="1024" id="qText"
                                  placeholder="Например: «И это пройдёт.»"></textarea>
                        <div class="d-flex justify-content-between align-items-center mt-1">
                            <span class="text-danger" asp-validation-for="Text"></span>
                            <small class="text-muted"><span id="qTextCnt">0</span>/1024</small>
                        </div>

                        <div class="mt-3">
                            <label class="form-label fw-semibold">Автор (необязательно)</label>
                            <input asp-for="Author" class="form-control" id="qAuthor" maxlength="128" placeholder="Автор / источник" />
                            <div class="d-flex justify-content-between align-items-center mt-1">
                                <span class="text-danger" asp-validation-for="Author"></span>
                                <small class="text-muted"><span id="qAuthorCnt">0</span>/128</small>
                            </div>
                        </div>

                        <div class="mt-4">
                            <div class="pill">Предпросмотр</div>
                            <div class="quote-preview mt-2">
                                <figure class="mb-0">
                                    <blockquote id="pvText">@Model.Text</blockquote>
                                    <figcaption class="mt-1" id="pvAuthor">
                                        @if (!string.IsNullOrWhiteSpace(Model.Author))
                                        {
                                            @Model.Author
                                        }
                                        else
                                        {
                                            <span class="text-muted">Автор не указан</span>
                                        }
                                    </figcaption>
                                </figure>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Правая колонка: параметры -->
            <div class="col-lg-4">
                <div class="card-ui mb-3">
                    <div class="head">Параметры</div>
                    <div class="p-3 p-md-4">
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Эмоция</label>
                            <select asp-for="EmotionId" class="form-select" asp-items="ViewBag.Emotions">
                                <option value="">— выберите эмоцию —</option>
                            </select>
                            <span asp-validation-for="EmotionId" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-semibold">Порядок</label>
                            <input asp-for="SortOrder" class="form-control" inputmode="numeric" />
                            <div class="form-text">Опционально. Меньше — выше в списке.</div>
                        </div>

                        <div class="form-check form-switch">
                            <input asp-for="IsActive" class="form-check-input" role="switch" />
                            <label asp-for="IsActive" class="form-check-label">Активна (показывать на сайте)</label>
                        </div>
                    </div>
                </div>

                <div class="d-grid d-lg-none gap-2">
                    <button type="submit" name="saveAction" value="save-back" class="btn btn-primary">
                        Сохранить и назад
                    </button>
                    <button type="submit" name="saveAction" value="save-add" class="btn btn-outline-primary">
                        Сохранить и добавить ещё
                    </button>
                    <a class="btn btn-ghost" asp-area="Admin" asp-controller="Quotes" asp-action="Index">Отмена</a>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        (function () {
            const txt = document.getElementById('qText');
            const aut = document.getElementById('qAuthor');
            const cntT = document.getElementById('qTextCnt');
            const cntA = document.getElementById('qAuthorCnt');
            const pvT = document.getElementById('pvText');
            const pvA = document.getElementById('pvAuthor');

            function updateCount(input, label) {
                if (!input || !label) return;
                label.textContent = (input.value || '').length;
            }
            function updatePreview() {
                const t = (txt?.value || '').trim();
                pvT.textContent = t || '(текст цитаты)';
                const a = (aut?.value || '').trim();
                pvA.innerHTML = a ? a : '<span class="text-muted">Автор не указан</span>';
            }
            function grow(el) {
                if (!el) return;
                el.style.height = 'auto';
                el.style.height = (el.scrollHeight + 2) + 'px';
            }

            // init
            updateCount(txt, cntT); updateCount(aut, cntA);
            updatePreview(); grow(txt);

            ['input', 'change'].forEach(ev => {
                if (txt) txt.addEventListener(ev, () => { updateCount(txt, cntT); updatePreview(); grow(txt); });
                if (aut) aut.addEventListener(ev, () => { updateCount(aut, cntA); updatePreview(); });
            });
        })();
    </script>
}