@model FeelShare.Web.ViewModels.ProfileIndexVM
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using FeelShare.Web.Models

@{
    ViewData["Title"] = "Профиль";
    var initial = (Model.DisplayName ?? "?").Trim();
    initial = string.IsNullOrEmpty(initial) ? "?" : initial.Substring(0, 1).ToUpperInvariant();
}



<!-- HERO -->
<section class="profile-hero mb-4">
    <div class="container px-3">
        <div class="d-flex align-items-center gap-3">
            <div class="avatar">
                <span>@initial</span>
            </div>
            <div class="text-white">
                <h1 class="display-6 fw-bold mb-1">Привет, @Model.DisplayName!</h1>
                <p class="mb-0 hero-sub">Быстрый доступ к статистике, последним записям, историям и комментариям.</p>
            </div>
        </div>
    </div>
    <div class="hero-art" aria-hidden="true"></div>
</section>

<!-- СТАТИСТИКА -->
<div class="container px-3">
    <div class="row g-3 mb-4">
        <div class="col-6 col-md-3">
            <div class="stat-card">
                <div class="stat-icon bg-1">📓</div>
                <div class="stat-numbers">
                    <div class="value">@Model.Stats.MyEntries</div>
                    <div class="label">Записей в дневнике</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="stat-card">
                <div class="stat-icon bg-2">✨</div>
                <div class="stat-numbers">
                    <div class="value">@Model.Stats.MyStories</div>
                    <div class="label">Опубликовано историй</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="stat-card">
                <div class="stat-icon bg-3">💬</div>
                <div class="stat-numbers">
                    <div class="value">@Model.Stats.MyComments</div>
                    <div class="label">Моих комментариев</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="stat-card">
                <div class="stat-icon bg-4">🤝</div>
                <div class="stat-numbers">
                    <div class="value">@Model.Stats.FeedbackToMe</div>
                    <div class="label">Комм. к моим историям</div>
                </div>
            </div>
        </div>
    </div>

    <!-- КОЛОНКИ КОНТЕНТА -->
    <div class="row g-4">
        <!-- Левая -->
        <div class="col-lg-6">
            <div class="block-card">
                <div class="block-head">
                    <h5 class="m-0">Последние записи дневника</h5>
                    <a class="btn btn-sm btn-ghost" asp-controller="Profile" asp-action="Me">Открыть весь дневник</a>
                </div>

                @if (!(Model.LatestEntries?.Any() ?? false))
                {
                    <div class="empty muted">
                        Пока записей нет. Сохраните первую заметку через выбранную эмоцию на главной.
                    </div>
                }
                else
                {
                    <div class="list clean">
                        @foreach (var e in Model.LatestEntries)
                        {
                            <div class="list-item">
                                <div class="meta small text-muted">
                                    @e.CreatedAtUtc.ToLocalTime().ToString("g") · @e.Emotion.Icon @e.Emotion.Name
                                </div>
                                <div class="content">
                                    @((e.Content?.Length ?? 0) > 220 ? e.Content.Substring(0, 220) + "…" : e.Content)
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>

        <!-- Правая -->
        <div class="col-lg-6">
            <div class="block-card">
                <div class="block-head">
                    <h5 class="m-0">Мои истории (последние)</h5>
                    <a class="btn btn-sm btn-ghost" asp-controller="Home" asp-action="Index">На главную</a>
                </div>

                @if (!(Model.LatestMyStories?.Any() ?? false))
                {
                    <div class="empty muted">Вы ещё не публиковали анонимных историй.</div>
                }
                else
                {
                    <div class="list clean">
                        @foreach (var s in Model.LatestMyStories)
                        {
                            <div class="list-item">
                                <div class="meta small text-muted">
                                    @s.CreatedAtLocal.ToLocalTime().ToString("g") · @s.EmotionIcon @s.EmotionName
                                    · <span title="Комментарии">💬 @s.CommentsCount</span>
                                    · <span title="Реакции">✨ @s.ReactionsCount</span>
                                </div>
                                <div class="content">@s.Preview</div>
                                <div>
                                    <a class="btn btn-sm btn-outline-primary rounded-3"
                                       asp-controller="Home" asp-action="Index"
                                       asp-route-sid="@s.Id" asp-fragment="s-@s.Id">
                                        Открыть на главной
                                    </a>
                                    <form method="post"
                                          asp-route="StoryDelete"
                                          asp-route-id="@s.Id"
                                          asp-route-returnUrl="@Url.Action("Index","Profile")"
                                          class="d-inline"
                                          onsubmit="return confirm('Удалить эту историю?');">
                                        @Html.AntiForgeryToken()
                                        <button class="btn btn-sm btn-outline-danger">Удалить</button>
                                    </form>
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>

            <div class="block-card mt-4">
                <div class="block-head">
                    <h5 class="m-0">Мои комментарии (последние)</h5>
                </div>

                @if (!(Model.LatestMyComments?.Any() ?? false))
                {
                    <div class="empty muted">Вы ещё не оставляли комментариев.</div>
                }
                else
                {
                    <div class="list clean">
                        @foreach (var c in Model.LatestMyComments)
                        {
                            <div class="list-item">
                                <div class="meta small text-muted">@c.CreatedAtLocal.ToString("g")</div>
                                <div class="content text-muted">История: @c.StoryPreview</div>
                                <div class="content">Мой комментарий: @c.CommentPreview</div>
                            </div>
                        }
                    </div>
                }
            </div>

            <div class="block-card mt-4">
                <div class="block-head">
                    <h5 class="m-0">Комментарии к моим историям</h5>
                </div>

                @if (!(Model.LatestFeedback?.Any() ?? false))
                {
                    <div class="empty muted">Пока никто не комментировал ваши истории.</div>
                }
                else
                {
                    <div class="list clean">
                        @foreach (var f in Model.LatestFeedback)
                        {
                            <div class="list-item">
                                <div class="meta small text-muted">
                                    @f.CreatedAtLocal.ToString("g") · от @f.From
                                </div>
                                <div class="content">@f.CommentPreview</div>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        :root {
            --ink: #0f172a; /* заголовки */
            --muted: #6b7280; /* подписи */
            --bg: #f8fafc; /* фон мягкий */
            --card: #ffffff; /* фон карточек */
            --border: #e5e7eb; /* границы */
            --shadow: 0 10px 25px rgba(2,6,23,.05);
            --acc1: #8b5cf6; /* фиолет */
            --acc2: #06b6d4; /* бирюза */
            --acc3: #22c55e; /* зелёный */
            --acc4: #f59e0b; /* янтарь */
            --acc5: #ef4444; /* алый */
        }

        .profile-hero {
            position: relative;
            background: linear-gradient(135deg, var(--acc1), var(--acc2));
            border-radius: 24px;
            padding: 28px 0;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

            .profile-hero .hero-sub {
                opacity: .9
            }

            .profile-hero .hero-art {
                position: absolute;
                inset: -15% -10% auto auto;
                width: 60%;
                height: 160%;
                background: radial-gradient(closest-side,rgba(255,255,255,.25),transparent 65%);
                transform: rotate(18deg);
                filter: blur(8px);
            }

        .avatar {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: grid;
            place-items: center;
            font-weight: 800;
            font-size: 24px;
            color: #1f2937;
            background: #fff;
            box-shadow: var(--shadow);
        }

        .stat-card {
            display: flex;
            gap: 12px;
            align-items: center;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 14px 14px;
            box-shadow: var(--shadow);
        }

        .stat-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: grid;
            place-items: center;
            font-size: 20px;
            color: #fff;
            font-weight: 700;
        }

            .stat-icon.bg-1 {
                background: linear-gradient(135deg,#6366f1,#8b5cf6);
            }

            .stat-icon.bg-2 {
                background: linear-gradient(135deg,#0ea5e9,#06b6d4);
            }

            .stat-icon.bg-3 {
                background: linear-gradient(135deg,#22c55e,#14b8a6);
            }

            .stat-icon.bg-4 {
                background: linear-gradient(135deg,#f59e0b,#ef4444);
            }

        .stat-numbers .value {
            font-size: 22px;
            line-height: 1;
            font-weight: 800;
            color: var(--ink)
        }

        .stat-numbers .label {
            font-size: .9rem;
            color: var(--muted)
        }

        .block-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: var(--shadow);
        }

        .block-head {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .btn-ghost {
            border: 1px dashed var(--border);
            background: transparent;
            color: var(--muted);
            padding: .35rem .75rem;
            border-radius: .65rem;
            text-decoration: none;
        }

            .btn-ghost:hover {
                border-color: var(--acc1);
                color: var(--acc1)
            }

        .empty {
            padding: 18px 16px;
        }

            .empty.muted {
                color: var(--muted);
            }

        .list.clean {
            padding: 8px 2px;
        }

        .list-item {
            padding: 12px 16px;
            border-bottom: 1px dashed var(--border);
        }

            .list-item:last-child {
                border-bottom: none
            }

            .list-item .meta {
                margin-bottom: 6px;
            }

            .list-item .content {
                white-space: pre-wrap;
            }

        /* мелкие твики */
        h5 {
            color: var(--ink);
            font-weight: 700;
            letter-spacing: .2px;
        }
    </style>
}